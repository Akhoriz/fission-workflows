# Httpwhale shows the use of the built-in, internal HTTP function by looking up your IP.
#
# Usage example: fission fn test --name httpwhale
apiVersion: 1
output: Whalify
tasks:
  # Fetch the IP using the internal function HTTP.
  FetchMyIp:
    run: http
    inputs:
      url: "http://ifconfig.co"

  # Fetch the IP using the HTTP runtime.
  FetchMyIp2:
    run: "http://ifconfig.co"

  EnsureEqualIPs:
    run: if
    inputs:
      if: "{ output('FetchMyIp') != output('FetchMyIp2') }"
      then:
        run: fail
        inputs: "{ output('FetchMyIp') + ' != ' + output('FetchMyIp2') }"
    requires:
    - GetIPWithInternalHTTPFunction
    - FetchMyIp2

  Whalify:
    run: whalesay
    inputs:
      body: "{ output('FetchMyIp') }"
    requires:
    - EnsureEqualIPs